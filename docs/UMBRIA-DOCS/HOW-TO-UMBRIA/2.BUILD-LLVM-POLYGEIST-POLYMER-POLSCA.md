# Start Building


## 1. CLONE `polsca-forked-umbria`

```sh
git clone https://github.com/pal-stdr/polsca-forked-umbria.git
```


## 2. Recursively load all the submodules

```sh
# Sync first
git submodule sync

# (Not recommended because of polymer/pluto)
git submodule update --init --recursive
```

### If you have internet connection problem, then your submodule load might fail

- To avoid such issue, load submodules one by one

```sh
# git submodule update --init --recursive -- submodule-name

git submodule update --init example/machsuite
git submodule update --init example/polybench
git submodule update --init example/rosetta

git submodule update --init --recursive -- polygeist

# Or,
# git submodule update --init -- polygeist
# git submodule update --init -- polygeist/llvm-project

git submodule update --init -- polymer
cd polymer/
git submodule update --init -- llvm-9-src-for-polymer-pluto
cd ..

# Donot need to load polymer/pluto. It will be handled by polymer build


# For llvm 16 (need clang, clang++ for upcoming scalehls build)
git submodule update --init -- llvm-16-src


# For scalehls
git submodule update --init -- scalehls-umbria-forked
cd scalehls-umbria-forked/
git submodule update --init --recursive -- polygeist
cd ..
```


## 3. Build the `llvm-project` inside `polygeist` (i.e. `polygeist/llvm-project`)

- **This script will create 2 folders in your project-root: `llvm-14-src-build-for-polygeist-polymer-polsca/` & `llvm-14-src-build-for-polygeist-polymer-polsca-installation/`. `llvm-14-src-build-for-polygeist-polymer-polsca-installation/` would not be populated with final assets (i.e. `bin/`, `include/`, `lib/` dirs) to save space. But you can do it if you activate `ninja install` at the end of the script.**.

```sh
./scripts/umbria-scripts/build-llvm-14-from-polygeist.sh
```



## 4. Build the `polygeist`

- **This script will create 2 folders in your project-root: `polygeist-build-for-polsca/` & `polygeist-build-for-polsca-installation/`**.

```sh
./scripts/umbria-scripts/build-polygeist.sh
```



## 5. Build the `polymer/llvm-9-src-for-polymer-pluto` for pluto's `pet-for-pluto` dependency

- **This script will create 2 folders in your project-root: `llvm-9-src-build-for-polymer-pluto/` & `llvm-9-src-build-for-polymer-pluto-installation/`**.

```sh
./scripts/umbria-scripts/build-llvm-9-for-polymer-pluto.sh
```

- Collect the installation path (i.e. `llvm-9-src-build-for-polymer-pluto-installation/`) for polymer build dependency `PLUTO_LIBCLANG_PREFIX_DIR`.



## 6. Build the `polymer`

- **This script will create 2 folders in your project-root: `polymer-build-for-polsca/` & `polymer-build-for-polsca-installation/`.**.

- Use `llvm-9-src-build-for-polymer-pluto-installation/` for `PLUTO_LIBCLANG_PREFIX_DIR`.

- Use `llvm-build-for-polygeist-polymer-polsca` for ``.

```sh
./scripts/umbria-scripts/build-polymer.sh
```

### 6.1. Issue with building pluto

- If you ever get issue with building pluto like following

```sh
- make: *** No targets specified and no makefile found.  Stop.
make: *** No rule to make target 'install'.  Stop.
-- Will build and use Polymer-bundled Pluto
-- dir='/path/to/polygeist/llvm-project/llvm/include'
-- dir='/path/to/llvm-build-for-polygeist-polymer-polsca/include'
-- dir='/path/to/polygeist/llvm-project/mlir/include'
-- dir='/path/to/llvm-build-for-polygeist-polymer-polsca/tools/mlir/include'
-- dir='/path/to/polymer-build/pluto/include'
-- dir='/path/to/polymer/include'
-- dir='/path/to/polymer-build/include'
-- Configuring done
.........
.....

-- Generating done
-- Build files have been written to: /path/to/polymer-build
ninja: error: 'pluto/lib/libisl.so', needed by 'lib/libPolymerSupport.a', missing and no known rule to make it

```

### 6.2. Fix

```sh
cd polymer/

# Clean pluto submodule
git submodule deinit -f -- pluto

# Change to Polsca dir again
cd ..

# Run polymer build again
./scripts/umbria-scripts/build-polymer.sh

```



## 7. Build the `polsca` (a.k.a `phism`)

- **This script will create 2 folders in your project-root: `polsca-build/` & `polsca-build-installation/`**.

```sh
./scripts/umbria-scripts/build-phism.sh
```



## 8. Build `llvm 16` for having `clang` & `clang++` for scalehls build process.

- Without `clang` & `clang++` compiler, the `scalehls-umbria-forked/polygeist/llvm-project` is buggy and too slow; often crashes due to RAM memory overrun. So we have to prepare it before jumping there.

- **This script will create 2 folders in your project-root: `llvm-16-src-build/` & `llvm-16-src-build-installation/`. `llvm-16-src-build-installation/` would not be populated with final assets (i.e. `bin/`, `include/`, `lib/` dirs) to save space. But you can do it if you activate `ninja install` at the end of the script.**.

```sh
./scripts/umbria-scripts/build-llvm-16.sh
```



## 9. Build `llvm 16` from inside of `scalehls-umbria-forked/polygeist/llvm-project` for scalehls

- **This script will create 2 folders in your project-root: `llvm-16-src-build-for-scalehls/` & `llvm-16-src-build-for-scalehls-installation/`. `llvm-16-src-build-for-scalehls-installation/` would not be populated with final assets (i.e. `bin/`, `include/`, `lib/` dirs) to save space. But you can do it if you activate `ninja install` at the end of the script.**.

```sh
./scripts/umbria-scripts/build-llvm-16-for-scalehls.sh
```


## 10. Build `scalehls`

-- **This script will create 2 folders in your project-root: `scalehls-build/` & `scalehls-build-installation/`.**

```sh
./scripts/umbria-scripts/build-scalehls.sh
```