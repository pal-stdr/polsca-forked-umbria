# Start Building


## 1. CLONE `polsca-forked-umbria`

```sh
git clone https://github.com/pal-stdr/polsca-forked-umbria.git
```


## 2. Recursively load all the submodules

```sh
# Sync first
git submodule sync


git submodule update --init --recursive
```

### If you have internet connection problem, then your submodule load might fail

- To avoid such issue, load submodules one by one

```sh
# git submodule update --init --recursive -- submodule-name

git submodule update --init example/machsuite
git submodule update --init example/polybench
git submodule update --init example/rosetta

git submodule update --init --recursive -- polygeist

# Or,
# git submodule update --init -- polygeist
# git submodule update --init -- polygeist/llvm-project

git submodule update --init -- polymer
cd polymer/
git submodule update --init -- llvm-9-src-for-polymer-pluto

# Donot need to load polymer/pluto. It will be handled by polymer build
```


## 3. Build the `llvm-project` inside `polygeist` (i.e. `polygeist/llvm-project`)

- **This script will create 2 folders in your project-root: `llvm-build-for-polygeist-polymer-polsca/` & `llvm-build-for-polygeist-polymer-polsca-installation/`**.

```sh
./scripts/umbria-scripts/build-llvm.sh
```



## 4. Build the `polygeist`

- **This script will create 2 folders in your project-root: `polygeist-build-for-polsca/` & `polygeist-build-for-polsca-installation/`**.

```sh
./scripts/umbria-scripts/build-polygeist.sh
```



## 5. Build the `polymer/llvm-9-src-for-polymer-pluto` for pluto's `pet-for-pluto` dependency

- **This script will create 2 folders in your project-root: `llvm-9-src-build-for-polymer-pluto/` & `llvm-9-src-build-for-polymer-pluto-installation/`**.

```sh
./scripts/umbria-scripts/build-llvm-9-for-polymer-pluto.sh
```

- Collect the installation path (i.e. `llvm-9-src-build-for-polymer-pluto-installation/`) for polymer build dependency `PLUTO_LIBCLANG_PREFIX_DIR`.



## 6. Build the `polymer`

- **This script will create 2 folders in your project-root: `polymer-build-for-polsca/` & `polymer-build-for-polsca-installation/`**.

- Use `llvm-9-src-build-for-polymer-pluto-installation/` for `PLUTO_LIBCLANG_PREFIX_DIR`.

- Use `llvm-build-for-polygeist-polymer-polsca` for ``.

```sh
./scripts/umbria-scripts/build-polymer.sh
```

### 6.1. Issue with building pluto

- If you ever get issue with building pluto like following

```sh
- make: *** No targets specified and no makefile found.  Stop.
make: *** No rule to make target 'install'.  Stop.
-- Will build and use Polymer-bundled Pluto
-- dir='/path/to/polygeist/llvm-project/llvm/include'
-- dir='/path/to/llvm-build-for-polygeist-polymer-polsca/include'
-- dir='/path/to/polygeist/llvm-project/mlir/include'
-- dir='/path/to/llvm-build-for-polygeist-polymer-polsca/tools/mlir/include'
-- dir='/path/to/polymer-build/pluto/include'
-- dir='/path/to/polymer/include'
-- dir='/path/to/polymer-build/include'
-- Configuring done
.........
.....

-- Generating done
-- Build files have been written to: /path/to/polymer-build
ninja: error: 'pluto/lib/libisl.so', needed by 'lib/libPolymerSupport.a', missing and no known rule to make it

```

### 6.2. Fix

```sh
cd polymer/

# Clean pluto submodule
git submodule deinit -f -- pluto

# Change to Polsca dir again
cd ..

# Run polymer build again
./scripts/umbria-scripts/build-polymer.sh

```



## 7. Build the `polsca` (a.k.a `phism`)

- **This script will create 2 folders in your project-root: `polsca-build/` & `polsca-build-installation/`**.

```sh
./scripts/umbria-scripts/build-phism.sh
```