# 1. How to remove a git `submodule`

Let's assume you want to remove the default `polymer` submodule that comes with `main` branch of `Polsca`.

## 1.1. First De-initialize the `polymer`

- **(OPTIONAL): If you already initialize the submodule with `git submodule update --init` command**

```sh
# Optional
git submodule deinit --init -- polymer
```

- **Actual step**

```sh
git submodule deinit -f -- polymer/

# Returns
# If you only run `git submodule deinit -f polymer/` command, then you might see the following error msg.
# Don't worry about the error msg. Because while I am running it, I didn't run `git submodule update --init` before. That's why '.git/modules/polymer' dir doesn't exist yet.
Cleared directory 'polymer'
error: could not lock config file .git/modules/polymer/config: No such file or directory
warning: Could not unset core.worktree setting in submodule 'polymer'


```

## 1.2. Remove the `polymer` folder with `git rm` command and `sync`

- This command will also remove the following entry from `.gitmodules`
```sh
[submodule "polymer"]
	path = polymer
	url = https://github.com/kumasento/polymer
```

```sh
git rm -f polymer/

# Returns
rm 'polymer'
```

- Now `sync`

```sh
git submodule sync
```


## 1.3. Validation. Check the `polymer` exists in the list

```sh
git submodule

# Returns (Polymer doesn't exist anymore)
-7b84770bdcfa6f8a06bae077e0f47b2fe649985e example/machsuite
-3e872547cef7e5c9909422ef1e6af03cf4e56072 example/polybench
-86c83a6596a9cf7a7af54510fd3ebde0cee81a8c example/rosetta
-2e6bb368ff4894993eb2102c1da3389fa18e49ef polygeist
```


## 1.4. Check the `git status`

- If you see the following message, verifies the process is correct.

```sh
On branch branch-name
Changes to be committed:
  (use "git restore --staged <file>..." to unstage)
        modified:   .gitmodules
        deleted:    polymer

Changes not staged for commit:
  (use "git add <file>..." to update what will be committed)
  (use "git restore <file>..." to discard changes in working directory)
        modified:   .gitmodules
```


## 1.5. Commit your changes

- **Do not add the same submodule from separate source in this commit.**











# 2. How to add a git `submodule`

- You can add different repositories as git `submodule` with 2 approaches.
- 1. Adding a git `branch` as submodule.
- 2. Adding a specific git commit `hash` or `tag` as submodule.


## 2.1. Adding a `branch`

### 2.1.1 Add the `branch`
```sh
git submodule add -b polsca-umbria --name polymer https://github.com/pal-stdr/polymer-forked-umbria.git polymer
```

- This command will create a entry in `.gitmodules` like following

```sh
[submodule "polymer"]
	path = polymer
	url = https://github.com/pal-stdr/polymer-forked-umbria.git
	branch = polsca-umbria
```

### 2.1.2 Now `sync`

```sh
git submodule sync

# Returns
Synchronizing submodule url for 'polymer'
```



## 2.2. Adding a specific commit `hash` or `tag`


- **Example case: Nlohmann json (for `C++`) setup as Submodule for `tag` (`v3.11.3`)**

### 2.2.1. Prepare `json` as a github hosted repository with necessary files.

- **We have to set the [`json`](https://github.com/nlohmann/json) submodule for a specific tag `v3.11.3`. It's not a `branch`. So actual process is quite different.**
- You donot need to change anything in [`json`](https://github.com/nlohmann/json).
- Prepare a separate git branch for submodule purpose.
- For `json`, could be found at [`json`](https://github.com/nlohmann/json/tree/v3.11.3) in `v3.11.3` tag.



## 2.2.2 Now add it as a `git` submodule in the parent repo (i.e. `pluto-forked`)

- **Run the following `git submodule add` command.**
```sh
git submodule add --name json https://github.com/nlohmann/json.git json

# Returns
Cloning into '/path/to/parent-repo/json'...
remote: Enumerating objects: 38209, done.
remote: Counting objects: 100% (91/91), done.
remote: Compressing objects: 100% (46/46), done.
remote: Total 38209 (delta 43), reused 69 (delta 33), pack-reused 38118
Receiving objects: 100% (38209/38209), 185.18 MiB | 8.21 MiB/s, done.
Resolving deltas: 100% (23463/23463), done.
```

**Explanation:**
You will see the `json/` is cloned to your parent repo. But it is pointing to default branch (i.e. `develop` for the `json` lib case). There it will automatically create git `index` and the following snippet inside `.gitmodules` file. You don't have to do anything manually. Donot worry about all the dumped files in the `json/` submodule.

```sh
[submodule "json"]
	path = json
	url = https://github.com/nlohmann/json.git
```


- **Go to the submodule dir.**

```sh
cd json/
```

- **Fetch all git `tags` for `json` submodule**

```sh
git fetch --tags
```

- **Checkout your desired version/`tag`**

```sh
git checkout tags/v3.11.3

# Returns
Note: switching to 'tags/v3.11.3'.

You are in 'detached HEAD' state....
....
HEAD is now at 9cca280a JSON for Modern C++ 3.11.3 (#4222)
```

- **Go back to the parent repo**

```sh
cd ..
```

- **git `stage` (i.e. `add`) the `json/` submodule**

This will stage `tag` specific (i.e. `v3.11.3`) files.

```sh
git stage json/

git status

# Returns

On branch how-to-setup-pluto
Your branch is up to date with 'origin/how-to-setup-pluto'.

Changes to be committed:
  (use "git restore --staged <file>..." to unstage)
        modified:   .gitmodules
        new file:   json
```

- **Now commit the changes**

```sh
git commit -m "Add 'json' submodule for checked out tag/version v3.11.3"

# Returns
2 files changed, 4 insertions(+)
create mode 160000 json
```


- **Verify if the right tag (i.e. `v3.11.3`) is included**

```sh
# Go to ".git/" dir
cd .git/

# Run grep search
grep -Rn . -e 'v3.11.3'

# Returns
./modules/json/packed-refs:77:9cca280a4d0ccf0c08f47a99aa71d1b0e52f8d03 refs/tags/v3.11.3
./modules/json/FETCH_HEAD:57:9cca280a4d0ccf0c08f47a99aa71d1b0e52f8d03   not-for-merge   tag 'v3.11.3' of https://github.com/nlohmann/json
./modules/json/logs/HEAD:2:8c391e04fe4195d8be862c97f38cfe10e2a3472e 9cca280a4d0ccf0c08f47a99aa71d1b0e52f8d03 Firstname Lastname <firstname.lastname@nomail.com> 1717432028 +0200        checkout: moving from develop to tags/v3.11.3
./logs/HEAD:3:fe6ac5c4902f8a4e2cc1cf99418c5cd36125eb30 b937db4811c82d68824352a550ca483b0e492a16 firstname lastname <firstname.lastname@nomail.com> 1717432117 +0200     commit: Add 'json' submodule for checked out tag/version v3.11.3
./logs/refs/heads/how-to-setup-pluto:2:fe6ac5c4902f8a4e2cc1cf99418c5cd36125eb30 b937db4811c82d68824352a550ca483b0e492a16 firstname lastname <pallab.sutradhar@nomail.com> 1717432117 +0200commit: Add 'json' submodule for checked out tag/version v3.11.3
./COMMIT_EDITMSG:1:Add 'json' submodule for checked out tag/version v3.11.3
```

