UMBRIA_POLYBENCH_POLLY_CPU_FLOW_RELATIVE_TMP_DIR=$(UMBRIA_CPU_FLOW_RELATIVE_TMP_DIR)/polybench
UMBRIA_POLYBENCH_POLLY_PYTHON_SCRIPT=scripts/umbria-scripts/umbria-polybench-cpu-flow.py
POLLY_POLYBENCH_SRC_DIR=./example/polybench
POLLY_POLYBENCH_DATASET=SMALL

# You can run multiple kernel examples; or just one kernel.
POLLY_POLYBENCH_EXAMPLES=symm syr2k trmm 2mm
# POLLY_EXCLUDE_POLYBENCH_KERNELS=symm doitgen fdtd-2d nussinov
POLLY_EXCLUDE_POLYBENCH_KERNELS=deriche correlation floyd-warshall nussinov
POLLY_EXCLUDE_POLYBENCH_KERNELS_FOR_SCALEHLS_TRANSFORMATION=deriche correlation floyd-warshall nussinov



# Only --enable-polly flow

verify-one-polybench-kernel-with-polly-umbria-cpu-flow:
	PYTHONPATH=$(shell pwd) python3 $(UMBRIA_POLYBENCH_POLLY_PYTHON_SCRIPT) --source-dir $(POLLY_POLYBENCH_SRC_DIR) -e $(POLLY_POLYBENCH_EXAMPLES) --work-dir $(UMBRIA_POLYBENCH_POLLY_CPU_FLOW_RELATIVE_TMP_DIR)/verify-one-polybench-kernel-with-polly --dataset=$(POLLY_POLYBENCH_DATASET) --enable-polly --enable-polly-polyhedral --polly-omp-opt --verify-benchmark-result --error-threshold 0.00000001 --dump-csv-report


verify-polybench-kernels-with-polly-isl-umbria-cpu-flow:
	PYTHONPATH=$(shell pwd) python3 $(UMBRIA_POLYBENCH_POLLY_PYTHON_SCRIPT) -j $(th) --source-dir $(POLLY_POLYBENCH_SRC_DIR) --work-dir $(UMBRIA_POLYBENCH_POLLY_CPU_FLOW_RELATIVE_TMP_DIR)/verify-polybench-kernels-with-polly-isl --dataset=$(POLLY_POLYBENCH_DATASET) --enable-polly --enable-polly-polyhedral --clang-opt --verify-benchmark-result --error-threshold 0.00000001 --dump-csv-report --excl $(POLLY_EXCLUDE_POLYBENCH_KERNELS)



run-one-polybench-kernel-with-polly-no-opt-umbria-cpu-flow:
	PYTHONPATH=$(shell pwd) python3 $(UMBRIA_POLYBENCH_POLLY_PYTHON_SCRIPT) --source-dir $(POLLY_POLYBENCH_SRC_DIR) -e $(POLLY_POLYBENCH_EXAMPLES) --work-dir $(UMBRIA_POLYBENCH_POLLY_CPU_FLOW_RELATIVE_TMP_DIR)/run-one-polybench-kernel-with-polly-no-opt --dataset=$(POLLY_POLYBENCH_DATASET) --enable-polly --run-bin-on-cpu


run-polybench-kernels-with-polly-no-opt-umbria-cpu-flow:
	PYTHONPATH=$(shell pwd) python3 $(UMBRIA_POLYBENCH_POLLY_PYTHON_SCRIPT) -j $(th) --source-dir $(POLLY_POLYBENCH_SRC_DIR) --work-dir $(UMBRIA_POLYBENCH_POLLY_CPU_FLOW_RELATIVE_TMP_DIR)/run-polybench-kernels-with-polly-no-opt --dataset=$(POLLY_POLYBENCH_DATASET) --enable-polly --run-bin-on-cpu --dump-csv-report --excl $(POLLY_EXCLUDE_POLYBENCH_KERNELS)



run-one-polybench-kernel-with-polly-isl-opt-umbria-cpu-flow:
	PYTHONPATH=$(shell pwd) python3 $(UMBRIA_POLYBENCH_POLLY_PYTHON_SCRIPT) --source-dir $(POLLY_POLYBENCH_SRC_DIR) -e $(POLLY_POLYBENCH_EXAMPLES) --work-dir $(UMBRIA_POLYBENCH_POLLY_CPU_FLOW_RELATIVE_TMP_DIR)/run-one-polybench-kernel-with-polly-isl-opt --dataset=$(POLLY_POLYBENCH_DATASET) --enable-polly --enable-polly-polyhedral --polly-omp-opt --run-bin-on-cpu


run-polybench-kernels-with-polly-isl-opt-umbria-cpu-flow:
	PYTHONPATH=$(shell pwd) python3 $(UMBRIA_POLYBENCH_POLLY_PYTHON_SCRIPT) -j $(th) --source-dir $(POLLY_POLYBENCH_SRC_DIR) --work-dir $(UMBRIA_POLYBENCH_POLLY_CPU_FLOW_RELATIVE_TMP_DIR)/run-polybench-kernels-with-polly-isl-opt --dataset=$(POLLY_POLYBENCH_DATASET) --enable-polly --enable-polly-polyhedral --polly-omp-opt --run-bin-on-cpu --dump-csv-report --excl $(POLLY_EXCLUDE_POLYBENCH_KERNELS)



compile-one-polybench-kernel-with-polly-umbria-cpu-flow:
	PYTHONPATH=$(shell pwd) python3 $(UMBRIA_POLYBENCH_POLLY_PYTHON_SCRIPT) --source-dir $(POLLY_POLYBENCH_SRC_DIR) -e $(POLLY_POLYBENCH_EXAMPLES) --work-dir $(UMBRIA_POLYBENCH_POLLY_CPU_FLOW_RELATIVE_TMP_DIR)/compile-one-polybench-kernel-with-polly --dataset=$(POLLY_POLYBENCH_DATASET) --enable-polly --enable-polly-polyhedral --polly-omp-opt --dump-csv-report


compile-polybench-kernels-with-polly-umbria-cpu-flow:
	PYTHONPATH=$(shell pwd) python3 $(UMBRIA_POLYBENCH_POLLY_PYTHON_SCRIPT) -j $(th) --source-dir $(POLLY_POLYBENCH_SRC_DIR) --work-dir $(UMBRIA_POLYBENCH_POLLY_CPU_FLOW_RELATIVE_TMP_DIR)/compile-polybench-kernels-with-polly --dataset=$(POLLY_POLYBENCH_DATASET) --enable-polly --enable-polly-polyhedral --polly-omp-opt --dump-csv-report --excl $(POLLY_EXCLUDE_POLYBENCH_KERNELS)



